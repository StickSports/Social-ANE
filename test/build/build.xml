<?xml version="1.0" encoding="UTF-8"?>
<project name="ANE Test Build Scripts" default="build">
	
	<property file="build.config"/>

	<target name="build" depends="compile,ios-package"
		description="Build and package the banner test app."/>
	
	<target name="compile" description="Build a debug version of the application swf">
		<delete dir="../bin"/>
		<mkdir dir="../bin"/>
		
		<exec executable="${sdk.home}/bin/amxmlc${bin.ext}" failonerror="true" dir="../bin">
			<arg line='-source-path ../src'/>
			<arg line='-default-size=320,480'/>
			<arg line='-default-background-color 0x000000'/>
			<arg line='-default-frame-rate 30'/>
			<arg line='-debug=true'/>
			<arg line='-optimize=true'/>
			<arg line='-swf-version=13'/>
			<arg line='-external-library-path+="../../bin/Social.swc"'/>
			<arg line='-output SocialTest.swf'/>
			<arg line='../src/SocialTest.as'/>
		</exec>
		
	</target>
	
	<target name="ios-package" description="Create the debug application .ipa package">
		<copy file="./SocialTest-app.xml" todir="../bin" overwrite="true"/>
		<copy file="./Default.png" todir="../bin" overwrite="true"/>
		<copy todir="../bin/icons">
		    <fileset dir="./icons"/>
		</copy>

		<exec executable="${sdk.home}/bin/adt${bin.ext}" failonerror="true" dir="../bin">
			<arg value="-package"/>
			<arg value="-target"/>
			<arg value="ipa-debug-interpreter"/>
			<arg value="-connect"/>
			<arg value="-provisioning-profile"/>
			<arg value="${ios.provisioning.profile}"/>
			<arg value="-storetype"/>
			<arg value="pkcs12"/>
			<arg value="-keystore"/>
			<arg value="${ios.keystore.file}"/>
			<arg value="-storepass"/>
			<arg value="${ios.keystore.password}"/>
			<arg value="SocialTest.ipa"/>
			<arg value="SocialTest-app.xml"/>
			<arg value="SocialTest.swf"/>
			<arg value="Default.png"/>
			<arg value="icons"/>
			<arg line="-extdir ../../bin/"/>
		</exec>
	</target>
</project>
